!function(e){"use strict";function t(){return t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t.apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var i="default"in e?e.default:e,r=e.getComponent("Button"),o=function(e){function t(t,n){var i;return i=e.call(this,t,n)||this,i.el_.querySelector(".vjs-icon-placeholder").className+=" vjs-icon-picture-in-picture",i}n(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-pip-button "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=e.prototype.handleClick).call.apply(t,[this].concat(i)),this.player_.pictureInPicture().toggle()},t}(r);o.prototype.controlText_="Picture in Picture",e.registerComponent("PipButton",o),e.hook("setup",function(e){var t=e.findChild("SettingMenuButton")[0],n=t.parent,i=t.index;n.addChild(new o(e),{},i)});var a=e.getComponent("ClickableComponent"),p=function(e){function i(n,i){var r;return r=e.call(this,n,t({name:"ExitPipButton"},i))||this,r.addClass("vjs-exit-pip-button"),r.el_.querySelector(".vjs-icon-placeholder").innerHTML="&#10005;",r}return n(i,e),i.prototype.handleClick=function(){this.options_.parentPlayer.pictureInPicture().exit()},i}(a);p.prototype.controlText_="Exit Pictutre In Pictutre",e.registerComponent("ExitPipButton",p);var s=e.getComponent("Component"),l=function(e){function t(t,n){var i;return i=e.call(this,t,n)||this,t.addChild(new p(t,{parentPlayer:n.parentPlayer})),i.addChild(t),n.wrapper||(i.addClass("vjs-pip-player-wrapper"),document.body.appendChild(i.el_)),i}return n(t,e),t.prototype.createEl=function(){return this.options_.wrapper?this.options_.wrapper:e.prototype.createEl.call(this)},t}(s);e.registerComponent("PipPlayerWrapper",l);var c=e.getPlugin("plugin"),u=function(t){function r(e,n){var i;return void 0===n&&(n={}),i=t.call(this,e,n)||this,i.cache_={},i.pipPlayer=null,i.options_=n,i.parentPlayer=e,i}n(r,t);var o=r.prototype;return o.toggle=function(){this.pipPlayer?this.exit():this.init()},o.init=function(){this.pipPlayer||(this.handleOriginPlayer(),this.createPipPlayer())},o.createPipPlayer=function(){var t=this.parentPlayer,n=this.options_,r=t.id_+"-pip-player",o=e.dom.createEl("video",{id:r,className:"vjs-pip-player"});document.body.appendChild(o);var a=Object.assign(t.options_,t.cache_,{autoplay:!0,muted:t.muted()}),p=this.pipPlayer=i(o,a);this.wrapper=new l(p,Object.assign(n,{parentPlayer:t})),this.dragzone=p.getChild("PlayToggleLayer"),this.updatePosition(Object.assign({},this.cache_,n)),p.ready(function(){p.currentTime(t.currentTime()),p.play()}),!1!==n.draggable&&this.draggable(this.dragzone.el_)},o.handleOriginPlayer=function(){var e=this,t=this.parentPlayer;t.pause(),t.hasStarted(!1),t.controls(!1),t.addClass("vjs-pip-player-enabled"),t.one("play",function(){e.exit()})},o.exit=function(){var e=this.parentPlayer,t=this.pipPlayer,n=this.wrapper;e&&(e.controls(!0),e.removeClass("vjs-pip-player-enabled"),e.paused()&&e.play(),t&&(t.ended()||e.currentTime(t.currentTime()))),t&&(t.dispose(),n.dispose()),this.pipPlayer=null},o.dispose=function(){this.parentPlayer=null},o.updatePosition=function(e){var t=e.x,n=e.y;void 0!==t&&void 0!==n&&(this.wrapper.el_.style.bottom=n+"px",this.wrapper.el_.style.left=t+"px")},o.draggable=function(e){var t,n,i=this,r=this,o=function(r){r.preventDefault(),i.cache_.x=Math.max(0,Math.min(window.innerWidth-e.offsetWidth,r.clientX-t)),i.cache_.y=Math.max(0,Math.min(window.innerHeight-e.offsetHeight,window.innerHeight-r.clientY-e.offsetHeight+n)),i.updatePosition(i.cache_)};e.addEventListener("mousedown",function(e){e.preventDefault(),t=e.offsetX,n=e.offsetY;var i=function e(){window.removeEventListener("mousemove",e),r.dragzone.disable()};window.addEventListener("mousemove",o),window.addEventListener("mousemove",i),window.addEventListener("mouseup",function e(t){window.removeEventListener("mouseup",e),window.removeEventListener("mousemove",o),window.removeEventListener("mousemove",i),setTimeout(function(){r.dragzone.enable()},0)})});var a=function(){var t=i.cache_,n=t.x,r=t.y;i.updatePosition({x:Math.min(n,window.innerWidth-e.offsetWidth),y:Math.min(r,window.innerHeight-e.offsetHeight)})};window.addEventListener("resize",a),this.pipPlayer.on("dispose",function(){window.removeEventListener("resize",a)})},r}(c);e.registerPlugin("pictureInPicture",u)}(videojs);
