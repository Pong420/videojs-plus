{"version":3,"file":"index.js","sources":["../../../source/Plugin/PictureInPicture/ExitPipButton.js","../../../source/Plugin/PictureInPicture/PipPlayerWrapper.js","../../../source/Plugin/PictureInPicture/PipButton.js","../../../source/Plugin/PictureInPicture/PictureInPicture.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\nclass ExitPipButton extends ClickableComponent {\n  constructor(player, options) {\n    super(player, {\n      name: 'ExitPipButton',\n      ...options\n    });\n\n    this.addClass('vjs-exit-pip-button');\n\n    this.el_.querySelector('.vjs-icon-placeholder').innerHTML = '&#10005;';\n  }\n\n  handleClick() {\n    this.options_.parentPlayer.pictureInPicture().exit();\n  }\n}\n\nExitPipButton.prototype.controlText_ = 'Exit Pictutre In Pictutre';\n\nvideojs.registerComponent('ExitPipButton', ExitPipButton);\n\nexport default ExitPipButton;\n","import videojs from 'video.js';\nimport ExitPipButton from './ExitPipButton';\n\nconst Component = videojs.getComponent('Component');\n\nclass PipPlayerWrapper extends Component {\n  constructor(player, options) {\n    super(player, options);\n\n    player.addChild(\n      new ExitPipButton(player, {\n        parentPlayer: options.parentPlayer\n      })\n    );\n\n    this.addChild(player);\n\n    if (!options.wrapper) {\n      this.addClass('vjs-pip-player-wrapper');\n      document.body.appendChild(this.el_);\n    }\n  }\n\n  createEl() {\n    if (this.options_.wrapper) {\n      return this.options_.wrapper;\n    }\n\n    return super.createEl();\n  }\n}\n\nvideojs.registerComponent('PipPlayerWrapper', PipPlayerWrapper);\n\nexport default PipPlayerWrapper;\n","import videojs from 'video.js';\n\nconst Button = videojs.getComponent('Button');\n\nclass PipButton extends Button {\n  constructor(player, options) {\n    super(player, options);\n\n    this.el_.querySelector('.vjs-icon-placeholder').className +=\n      ' vjs-icon-picture-in-picture';\n  }\n\n  buildCSSClass() {\n    return `vjs-pip-button ${super.buildCSSClass()}`;\n  }\n\n  handleClick(...args) {\n    super.handleClick(...args);\n\n    this.player_.pictureInPicture().toggle();\n  }\n}\n\nPipButton.prototype.controlText_ = 'Picture in Picture';\n\nvideojs.registerComponent('PipButton', PipButton);\n\nvideojs.hook('setup', vjsPlayer => {\n  const { parent, index } = vjsPlayer.findChild('SettingMenuButton')[0];\n\n  parent.addChild(new PipButton(vjsPlayer), {}, index);\n});\n","import videojs from 'video.js';\n\nimport PipPlayerWrapper from './PipPlayerWrapper';\nimport './PictureInPicture.scss';\nimport './PipButton';\n\nclass pictureInPicture extends videojs.getPlugin('plugin') {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.cache_ = {};\n    this.pipPlayer = null;\n    this.options_ = options;\n    this.parentPlayer = player;\n  }\n\n  toggle() {\n    if (this.pipPlayer) {\n      this.exit();\n    } else {\n      this.init();\n    }\n  }\n\n  init() {\n    if (!this.pipPlayer) {\n      this.handleOriginPlayer();\n      this.createPipPlayer();\n    }\n  }\n\n  createPipPlayer() {\n    const { parentPlayer, options_ } = this;\n    const id = parentPlayer.id_ + '-pip-player';\n    const videoEl = videojs.dom.createEl('video', {\n      id,\n      className: 'vjs-pip-player'\n    });\n\n    document.body.appendChild(videoEl);\n\n    const pipPlayerOptions = {\n      ...parentPlayer.options_,\n      ...parentPlayer.cache_,\n      autoplay: true,\n      muted: parentPlayer.muted()\n    };\n\n    const pipPlayer = (this.pipPlayer = videojs(videoEl, pipPlayerOptions));\n\n    this.wrapper = new PipPlayerWrapper(pipPlayer, {\n      ...options_,\n      parentPlayer\n    });\n\n    this.dragzone = pipPlayer.getChild('PlayToggleLayer');\n\n    this.updatePosition({\n      ...this.cache_,\n      ...options_\n    });\n\n    pipPlayer.ready(() => {\n      pipPlayer.currentTime(parentPlayer.currentTime());\n      pipPlayer.play();\n    });\n\n    if (options_.draggable !== false) {\n      this.draggable(this.dragzone.el_);\n    }\n  }\n\n  handleOriginPlayer() {\n    const { parentPlayer } = this;\n\n    parentPlayer.pause();\n    parentPlayer.hasStarted(false);\n    parentPlayer.controls(false);\n    parentPlayer.addClass('vjs-pip-player-enabled');\n\n    parentPlayer.one('play', () => {\n      this.exit();\n    });\n  }\n\n  exit() {\n    const { parentPlayer, pipPlayer, wrapper } = this;\n\n    if (parentPlayer) {\n      parentPlayer.controls(true);\n      parentPlayer.removeClass('vjs-pip-player-enabled');\n      parentPlayer.paused() && parentPlayer.play();\n\n      if (pipPlayer) {\n        if (!pipPlayer.ended()) {\n          parentPlayer.currentTime(pipPlayer.currentTime());\n        }\n      }\n    }\n\n    if (pipPlayer) {\n      pipPlayer.dispose();\n      wrapper.dispose();\n    }\n\n    this.pipPlayer = null;\n  }\n\n  dispose() {\n    this.parentPlayer = null;\n  }\n\n  updatePosition({ x, y }) {\n    if (typeof x !== 'undefined' && typeof y !== 'undefined') {\n      this.wrapper.el_.style.bottom = y + 'px';\n      this.wrapper.el_.style.left = x + 'px';\n    }\n  }\n\n  draggable(el) {\n    let x, y;\n    const _this = this;\n\n    const move = evt => {\n      evt.preventDefault();\n\n      this.cache_.x = Math.max(\n        0,\n        Math.min(window.innerWidth - el.offsetWidth, evt.clientX - x)\n      );\n      this.cache_.y = Math.max(\n        0,\n        Math.min(\n          window.innerHeight - el.offsetHeight,\n          window.innerHeight - evt.clientY - el.offsetHeight + y\n        )\n      );\n\n      this.updatePosition(this.cache_);\n    };\n\n    el.addEventListener('mousedown', evt => {\n      evt.preventDefault();\n\n      x = evt.offsetX;\n      y = evt.offsetY;\n\n      const disableClick = () => {\n        window.removeEventListener('mousemove', disableClick);\n        _this.dragzone.disable();\n      };\n\n      window.addEventListener('mousemove', move);\n      window.addEventListener('mousemove', disableClick);\n\n      window.addEventListener('mouseup', function mouseup(evt) {\n        window.removeEventListener('mouseup', mouseup);\n        window.removeEventListener('mousemove', move);\n        window.removeEventListener('mousemove', disableClick);\n\n        setTimeout(() => {\n          _this.dragzone.enable();\n        }, 0);\n      });\n    });\n\n    const onResize = () => {\n      const { x, y } = this.cache_;\n\n      this.updatePosition({\n        x: Math.min(x, window.innerWidth - el.offsetWidth),\n        y: Math.min(y, window.innerHeight - el.offsetHeight)\n      });\n    };\n\n    window.addEventListener('resize', onResize);\n\n    this.pipPlayer.on('dispose', () => {\n      window.removeEventListener('resize', onResize);\n    });\n  }\n}\n\nvideojs.registerPlugin('pictureInPicture', pictureInPicture);\n"],"names":["ClickableComponent","videojs","getComponent","ExitPipButton","player","options","name","addClass","el_","querySelector","innerHTML","handleClick","options_","parentPlayer","pictureInPicture","exit","prototype","controlText_","registerComponent","Component","PipPlayerWrapper","addChild","wrapper","document","body","appendChild","createEl","Button","PipButton","className","buildCSSClass","args","player_","toggle","hook","vjsPlayer","findChild","parent","index","cache_","pipPlayer","init","handleOriginPlayer","createPipPlayer","id","id_","videoEl","dom","pipPlayerOptions","autoplay","muted","dragzone","getChild","updatePosition","ready","currentTime","play","draggable","pause","hasStarted","controls","one","removeClass","paused","ended","dispose","x","y","style","bottom","left","el","_this","move","evt","preventDefault","Math","max","min","window","innerWidth","offsetWidth","clientX","innerHeight","offsetHeight","clientY","addEventListener","offsetX","offsetY","disableClick","removeEventListener","disable","mouseup","setTimeout","enable","onResize","on","getPlugin","registerPlugin"],"mappings":"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"}