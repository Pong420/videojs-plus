{"version":3,"file":"picture-in-picture.es.js","sources":["../../../source/Plugin/PictureInPicture/ExitPipButton.js","../../../source/Plugin/PictureInPicture/PipPlayerWrapper.js","../../../source/Plugin/PictureInPicture/PipButton.js","../../../source/Plugin/PictureInPicture/PictureInPicture.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\nclass ExitPipButton extends ClickableComponent {\n  constructor(player, options) {\n    super(player, {\n      name: 'ExitPipButton',\n      ...options\n    });\n\n    this.addClass('vjs-exit-pip-button');\n\n    this.el_.querySelector('.vjs-icon-placeholder').innerHTML = '&#10005;';\n  }\n\n  handleClick() {\n    this.options_.parentPlayer.pictureInPicture().exit();\n  }\n}\n\nExitPipButton.prototype.controlText_ = 'Exit Pictutre In Pictutre';\n\nvideojs.registerComponent('ExitPipButton', ExitPipButton);\n\nexport default ExitPipButton;\n","import videojs from 'video.js';\nimport ExitPipButton from './ExitPipButton';\n\nconst Component = videojs.getComponent('Component');\n\nclass PipPlayerWrapper extends Component {\n  constructor(player, options) {\n    super(player, options);\n\n    player.addChild(\n      new ExitPipButton(player, {\n        parentPlayer: options.parentPlayer\n      })\n    );\n\n    this.addChild(player);\n\n    if (!options.wrapper) {\n      this.addClass('vjs-pip-player-wrapper');\n      document.body.appendChild(this.el_);\n    }\n  }\n\n  createEl() {\n    if (this.options_.wrapper) {\n      return this.options_.wrapper;\n    }\n\n    return super.createEl();\n  }\n}\n\nvideojs.registerComponent('PipPlayerWrapper', PipPlayerWrapper);\n\nexport default PipPlayerWrapper;\n","import videojs from 'video.js';\n\nconst Button = videojs.getComponent('Button');\n\nclass PipButton extends Button {\n  constructor(player, options) {\n    super(player, options);\n\n    this.el_.querySelector('.vjs-icon-placeholder').className +=\n      ' vjs-icon-picture-in-picture';\n  }\n\n  buildCSSClass() {\n    return `vjs-pip-button ${super.buildCSSClass()}`;\n  }\n\n  handleClick(...args) {\n    super.handleClick(...args);\n\n    this.player_.pictureInPicture().toggle();\n  }\n}\n\nPipButton.prototype.controlText_ = 'Picture in Picture';\n\nvideojs.registerComponent('PipButton', PipButton);\n\nvideojs.hook('setup', vjsPlayer => {\n  const { parent, index } = vjsPlayer.findChild('SettingMenuButton')[0];\n\n  parent.addChild(new PipButton(vjsPlayer), {}, index);\n});\n","import videojs from 'video.js';\n\nimport PipPlayerWrapper from './PipPlayerWrapper';\nimport './PictureInPicture.scss';\nimport './PipButton';\n\nclass pictureInPicture extends videojs.getPlugin('plugin') {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.cache_ = {};\n    this.pipPlayer = null;\n    this.options_ = options;\n    this.parentPlayer = player;\n  }\n\n  toggle() {\n    if (this.pipPlayer) {\n      this.exit();\n    } else {\n      this.init();\n    }\n  }\n\n  init() {\n    if (!this.pipPlayer) {\n      this.handleOriginPlayer();\n      this.createPipPlayer();\n    }\n  }\n\n  createPipPlayer() {\n    const { parentPlayer, options_ } = this;\n    const id = parentPlayer.id_ + '-pip-player';\n    const videoEl = videojs.dom.createEl('video', {\n      id,\n      className: 'vjs-pip-player'\n    });\n\n    document.body.appendChild(videoEl);\n\n    const pipPlayerOptions = {\n      ...parentPlayer.options_,\n      ...parentPlayer.cache_,\n      autoplay: true,\n      muted: parentPlayer.muted()\n    };\n\n    const pipPlayer = (this.pipPlayer = videojs(videoEl, pipPlayerOptions));\n\n    this.wrapper = new PipPlayerWrapper(pipPlayer, {\n      ...options_,\n      parentPlayer\n    });\n\n    this.dragzone = pipPlayer.getChild('PlayToggleLayer');\n\n    this.updatePosition({\n      ...this.cache_,\n      ...options_\n    });\n\n    pipPlayer.ready(() => {\n      pipPlayer.currentTime(parentPlayer.currentTime());\n      pipPlayer.play();\n    });\n\n    if (options_.draggable !== false) {\n      this.draggable(this.dragzone.el_);\n    }\n  }\n\n  handleOriginPlayer() {\n    const { parentPlayer } = this;\n\n    parentPlayer.pause();\n    parentPlayer.hasStarted(false);\n    parentPlayer.controls(false);\n    parentPlayer.addClass('vjs-pip-player-enabled');\n\n    parentPlayer.one('play', () => {\n      this.exit();\n    });\n  }\n\n  exit() {\n    const { parentPlayer, pipPlayer, wrapper } = this;\n\n    if (parentPlayer) {\n      parentPlayer.controls(true);\n      parentPlayer.removeClass('vjs-pip-player-enabled');\n      parentPlayer.paused() && parentPlayer.play();\n\n      if (pipPlayer) {\n        if (!pipPlayer.ended()) {\n          parentPlayer.currentTime(pipPlayer.currentTime());\n        }\n      }\n    }\n\n    if (pipPlayer) {\n      pipPlayer.dispose();\n      wrapper.dispose();\n    }\n\n    this.pipPlayer = null;\n  }\n\n  dispose() {\n    this.parentPlayer = null;\n  }\n\n  updatePosition({ x, y }) {\n    if (typeof x !== 'undefined' && typeof y !== 'undefined') {\n      this.wrapper.el_.style.bottom = y + 'px';\n      this.wrapper.el_.style.left = x + 'px';\n    }\n  }\n\n  draggable(el) {\n    let x, y;\n    const _this = this;\n\n    const move = evt => {\n      evt.preventDefault();\n\n      this.cache_.x = Math.max(\n        0,\n        Math.min(window.innerWidth - el.offsetWidth, evt.clientX - x)\n      );\n      this.cache_.y = Math.max(\n        0,\n        Math.min(\n          window.innerHeight - el.offsetHeight,\n          window.innerHeight - evt.clientY - el.offsetHeight + y\n        )\n      );\n\n      this.updatePosition(this.cache_);\n    };\n\n    el.addEventListener('mousedown', evt => {\n      evt.preventDefault();\n\n      x = evt.offsetX;\n      y = evt.offsetY;\n\n      const disableClick = () => {\n        window.removeEventListener('mousemove', disableClick);\n        _this.dragzone.disable();\n      };\n\n      window.addEventListener('mousemove', move);\n      window.addEventListener('mousemove', disableClick);\n\n      window.addEventListener('mouseup', function mouseup(evt) {\n        window.removeEventListener('mouseup', mouseup);\n        window.removeEventListener('mousemove', move);\n        window.removeEventListener('mousemove', disableClick);\n\n        setTimeout(() => {\n          _this.dragzone.enable();\n        }, 0);\n      });\n    });\n\n    const onResize = () => {\n      const { x, y } = this.cache_;\n\n      this.updatePosition({\n        x: Math.min(x, window.innerWidth - el.offsetWidth),\n        y: Math.min(y, window.innerHeight - el.offsetHeight)\n      });\n    };\n\n    window.addEventListener('resize', onResize);\n\n    this.pipPlayer.on('dispose', () => {\n      window.removeEventListener('resize', onResize);\n    });\n  }\n}\n\nvideojs.registerPlugin('pictureInPicture', pictureInPicture);\n"],"names":["ClickableComponent","videojs","getComponent","ExitPipButton","player","options","name","addClass","el_","querySelector","innerHTML","handleClick","options_","parentPlayer","pictureInPicture","exit","prototype","controlText_","registerComponent","Component","PipPlayerWrapper","addChild","wrapper","document","body","appendChild","createEl","Button","PipButton","className","buildCSSClass","args","player_","toggle","hook","vjsPlayer","findChild","parent","index","cache_","pipPlayer","init","handleOriginPlayer","createPipPlayer","id","id_","videoEl","dom","pipPlayerOptions","autoplay","muted","dragzone","getChild","updatePosition","ready","currentTime","play","draggable","pause","hasStarted","controls","one","removeClass","paused","ended","dispose","x","y","style","bottom","left","el","_this","move","evt","preventDefault","Math","max","min","window","innerWidth","offsetWidth","clientX","innerHeight","offsetHeight","clientY","addEventListener","offsetX","offsetY","disableClick","removeEventListener","disable","mouseup","setTimeout","enable","onResize","on","getPlugin","registerPlugin"],"mappings":"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"}