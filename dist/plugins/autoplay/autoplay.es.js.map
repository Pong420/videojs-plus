{"version":3,"file":"autoplay.es.js","sources":["../../../source/Utils/Log.js","../../../source/Plugin/Autoplay/Autoplay.js"],"sourcesContent":["import videojs from 'video.js';\n\nlet logType = '';\n\ntry {\n  logType = localStorage && localStorage.getItem('vjs-plus-log');\n} catch (e) {}\n\nconst log = (function () {\n  if (logType === 'normal' || videojs.browser.IE_VERSION) {\n    // log without style\n    return console.info.bind(console, '[VJS Plus]:');\n  } else if (logType) {\n    // log with style\n    return console.info.bind(\n      console,\n      '%c[VJS Plus]:',\n      'font-weight: bold; color:#2196F3;'\n    );\n  }\n\n  return function () {};\n})();\n\nexport default log;\n","import videojs from 'video.js';\nimport log from '../../Utils/Log';\n\nconst AUTOPLAY_SUCCESS = 'autoplay-success';\nconst AUTOPLAY_FAILURE = 'autoplay-failure';\n\nconst AutoplayHandler = player => {\n  const NotPreoload = player.preload() === 'none';\n\n  if (!player.autoplay() || NotPreoload) {\n    player.mutedautoplay_ = 'ignore';\n\n    if (NotPreoload) {\n      log('Preload is none so that manual autoplay start is disabled');\n      player.trigger(AUTOPLAY_FAILURE);\n    }\n\n    return false;\n  }\n\n  const pause = player.pause;\n\n  player.pause = () => {};\n\n  const callback = () => {\n    player.pause = pause;\n\n    player.mutedautoplay_ = true;\n  };\n\n  const resolved = () => {\n    log('Muted Autoplay - Promise Resolved');\n\n    player.trigger(AUTOPLAY_SUCCESS);\n\n    callback();\n  };\n\n  const rejected = error => {\n    log('Muted Autoplay - Promise Rejected', error);\n\n    player.muted(true);\n\n    const handlePlay = player.play();\n\n    if (handlePlay) {\n      handlePlay.then(resolved).catch(err => {\n        log('Seems autoplay is not allowed even player is muted', err);\n        player.trigger(AUTOPLAY_FAILURE);\n        player.hasStarted(false);\n        callback();\n      });\n    } else {\n      log('Second Play Promise is undefined');\n      callback();\n    }\n  };\n\n  player.one('loadedmetadata', function handleMutedAutoplay() {\n    // without ready, `player.play()` may retutn `undefined` as `this.changingSrc_` is true\n    player.ready(() => {\n      const playPromise = player.play();\n\n      if (playPromise !== undefined && playPromise !== null) {\n        playPromise.then(resolved).catch(rejected);\n      } else {\n        log('Browser not support play promise');\n\n        setTimeout(callback, 1000);\n      }\n    });\n  });\n};\n\nvideojs.hook('setup', vjsPlayer => {\n  vjsPlayer.one('loadstart', () => {\n    AutoplayHandler(vjsPlayer);\n  });\n});\n"],"names":["logType","localStorage","getItem","e","log","videojs","browser","IE_VERSION","console","info","bind","AUTOPLAY_SUCCESS","AUTOPLAY_FAILURE","AutoplayHandler","player","NotPreoload","preload","autoplay","mutedautoplay_","trigger","pause","callback","resolved","rejected","error","muted","handlePlay","play","then","err","hasStarted","one","handleMutedAutoplay","ready","playPromise","undefined","setTimeout","hook","vjsPlayer"],"mappings":"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"}